---
title: 数据库表格设计与范式
date: 2019-03-21 10:45:45
tags: [范式,多对多]
---

#### 一、表设计

 数据库实体间是`一对多、多对多`关系时，如何进行表设计：

- `一对多`：添加外键
- `多对多` ：建立关系表

注：

- **添加外键**时，尽量只**记录外键**，**不创建外键约束**
- 推荐业务层级的约束，慎重使用数据库层级的约束，为表结构的重构提供可能性

```mysql
# 慎重
foreign key(member_id) references member (id);
```
<br/>

##### 业务层级约束

1. 物理删除

   删除数据时，手动查看当前数据**主键被引用的情况**

   - 存在引用，不能删除
   - 不存在引用，可以删除

   注：主键可能会被新增的表引用，因此每新增一个引用，都需要添加一种**查看引用情况**的逻辑

<br/>



2. 非物理删除

   ```
   # 使用status字段，表示数据的可用状态
   # 被其他表引用时，不添加外键约束
   # 删除数据时，不用考虑被其他表引用，从而导致数据不一致的情况
   status =  1： 可用。可执行操作包括，删、查、改
   status =  0： 不可用。可执行操作包括，删、查、改
   status = -1： 已删除。执行操作包括，查、改(只允许修改status字段)
   ```

<!--more-->

<br/>



#### 二、范式

##### 第一范式：

如果数据库表中的所有字段值都是不可分解的原子值，就说明该数据库表满足了第一范式

```
地址：可以拆分为省、市、区、详细地址
```

<br/>



##### 第二范式：

第二范式在第一范式的基础之上更进一层。

第二范式需要确保数据库表中的**每一列都和主键相关，而不能只与主键的某一部分相关**，主要针对**联合主键**而言。

也就是说在一个数据库表中，一个表中只能保存一种数据，不可以把多种数据保存在同一张数据库表中。

<br/>



##### 第三范式：

第三范式需要确保数据表中的每一列数据都和主键直接相关，而不能间接相关。

```
# 通过a不能直接获取c
a--> b --> c 
```

<br/>



